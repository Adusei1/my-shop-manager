<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sikaye Mother's Edition - Secure</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root { --rose: #be185d; --soft-pink: #fdf2f8; --gold: #b45309; --success: #047857; --card-bg: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #fff5f7; margin: 0; color: #475569; }
        
        #login-overlay { position: fixed; inset: 0; background: #be185d; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-box { background: white; padding: 40px; border-radius: 20px; text-align: center; width: 320px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        header { background: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid #fbcfe8; }
        .welcome-msg { color: #be185d; font-weight: bold; font-size: 18px; }

        #dashboard { display: none; padding: 15px; max-width: 900px; margin: auto; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 15px; border-radius: 15px; border-bottom: 4px solid #fbcfe8; text-align: center; }
        .stat-card h2 { margin: 5px 0; color: #be185d; font-size: 22px; }

        .card { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        input, select { padding: 12px; margin: 5px 0; border: 1px solid #fbcfe8; border-radius: 10px; width: 100%; box-sizing: border-box; font-size: 16px; }
        
        .btn { padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; }
        .btn-rose { background: #be185d; color: white; }
        .btn-sell { background: #059669; color: white; padding: 8px 12px; border-radius: 8px; border:none; cursor:pointer;}
        .btn-del { background: #fee2e2; color: #ef4444; border:none; padding: 8px; border-radius: 8px; cursor:pointer; margin-left:5px;}

        table { width: 100%; border-collapse: collapse; background: white; }
        th { background: #fdf2f8; color: #be185d; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .expired { color: #e11d48; font-weight: bold; font-size: 12px; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h1>üå∏ Welcome</h1>
        <p>Sikaye Mother's Shop</p>
        <input type="password" id="pinField" placeholder="Enter PIN" onkeyup="checkPin()" style="text-align:center; font-size: 24px;">
    </div>
</div>

<header id="main-header" style="display:none;">
    <div>
        <div class="welcome-msg">Hello, Mother! ‚ú®</div>
        <div class="manager-info">üìû 0552363578</div>
    </div>
    <button class="no-print" onclick="location.reload()">Exit</button>
</header>

<div id="dashboard">
    <div class="stats-grid no-print">
        <div class="stat-card"><small>Money Made Today</small><h2 id="sales-display">GH‚Çµ 0.00</h2></div>
        <div class="stat-card"><small>Actual Profit</small><h2 id="profit-display" style="color:#059669">GH‚Çµ 0.00</h2></div>
    </div>

    <div class="card no-print">
        <h3 style="margin-top:0; color:#be185d;">üì¶ Add New Item</h3>
        <input type="text" id="n" placeholder="Item Name">
        <div style="display:flex; gap:10px;">
            <select id="cat"><option value="medicine">Medicine</option><option value="cosmetics">Cosmetic</option></select>
            <input type="date" id="exp">
        </div>
        <div style="display:flex; gap:10px;">
            <input type="number" id="c" placeholder="Cost Price">
            <input type="number" id="p" placeholder="Sell Price">
            <input type="number" id="q" placeholder="Qty">
        </div>
        <button class="btn btn-rose" onclick="saveItem()">Add to Shop</button>
    </div>

    <div class="card">
        <h3 style="color:#be185d;">üõí Current Inventory</h3>
        <table>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th class="no-print">Action</th>
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
</div>

<script>
    // System Config
    const firebaseConfig = { 
        apiKey: "AIzaSyCiVPcvcjJCJ2-q19EEvmLu3QicDX3Fv8Q", 
        authDomain: "shop-manager-8ef6f.firebaseapp.com", 
        databaseURL: "https://shop-manager-8ef6f-default-rtdb.firebaseio.com", 
        projectId: "shop-manager-8ef6f" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Secure Date Helper (Fixes the "GH‚Çµ 0.00" bug)
    const getToday = () => new Date().toISOString().split('T')[0];

    function checkPin() {
        if (document.getElementById('pinField').value === "5892") {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('main-header').style.display = 'flex';
            loadData();
        }
    }

    function loadData() {
        db.ref('inventory').on('value', snap => {
            renderTable(snap.val() ? Object.values(snap.val()) : []);
        });
        
        db.ref('sales').on('value', snap => {
            const sales = snap.val() ? Object.values(snap.val()) : [];
            const today = getToday();
            let ts = 0, tp = 0;
            sales.forEach(s => { 
                if(s.date === today) { ts += s.price; tp += s.profit; }
            });
            document.getElementById('sales-display').innerText = `GH‚Çµ ${ts.toFixed(2)}`;
            document.getElementById('profit-display').innerText = `GH‚Çµ ${tp.toFixed(2)}`;
        });
    }

    function saveItem() {
        const name = document.getElementById('n').value.trim();
        if(!name) return alert("Enter a name!");
        
        const item = {
            name, category: document.getElementById('cat').value,
            cost: parseFloat(document.getElementById('c').value) || 0,
            price: parseFloat(document.getElementById('p').value) || 0,
            stock: parseInt(document.getElementById('q').value) || 0,
            expiry: document.getElementById('exp').value
        };
        db.ref('inventory/' + name).set(item);
        ['n','c','p','q','exp'].forEach(id => document.getElementById(id).value = '');
    }

    function sell(name, stock, price, cost) {
        if(stock <= 0) return alert("Out of stock!");
        db.ref('inventory/' + name + '/stock').transaction(s => s - 1);
        db.ref('sales').push({ name, price, profit: (price - cost), date: getToday() });
    }

    function removeItem(name) {
        if(confirm("Delete " + name + "?")) db.ref('inventory/' + name).remove();
    }

    function renderTable(data) {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = "";
        data.forEach(item => {
            const isExpired = item.expiry && new Date(item.expiry) < new Date();
            tbody.innerHTML += `<tr>
                <td><b>${item.name}</b>${isExpired ? '<br><span class="expired">EXPIRED</span>' : ''}</td>
                <td>‚Çµ${item.price.toFixed(2)}</td>
                <td style="color:${item.stock < 5 ? 'red' : 'inherit'}">${item.stock}</td>
                <td class="no-print">
                    <button class="btn-sell" onclick="sell('${item.name}', ${item.stock}, ${item.price}, ${item.cost})">Sell</button>
                    <button class="btn-del" onclick="removeItem('${item.name}')">üóëÔ∏è</button>
                </td>
            </tr>`;
        });
    }
</script>
</body>
</html>
